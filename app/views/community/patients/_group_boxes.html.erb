<div class="row">
  <label for="patient_group_ids_0">
    <input class="form-check-input" data-blank="" type="checkbox" value="" name="patient[group_ids][]" id="patient_group_ids_0">
    <i>
      Não me encaixo em nenhuma opção abaixo, ou não está na lista
    </i>
  </label>
</div>

<%= f.collection_check_boxes :group_ids, group.root.active.order(:position).includes(:children), :id, :name do |b| %>
  <div class="row">
    <%= b.label do
      b.check_box(
        checked: f.object.group_ids.include?(b.value.to_i),
        class: "form-check-input",
        data: { 'group-parent' => b.value },
        required: true # disabled via JS in case one is set
      ) + b.text
    end %>
  </div>

  <% if b.object.children.active.order(:position).any? %>
    <div class="form-row" hidden="true" data-group-child="<%= b.value %>">
      <div class="form-group col-md-8">
        <div class="form-check">
          <%= f.collection_check_boxes :group_ids, b.object.children.active.order(:position), :id, :name do |s| %>
            <div class="row">
              <%= s.label do
                s.check_box(
                  checked: f.object.group_ids.include?(s.value.to_i),
                  class: "form-check-input",
                  required: true # disabled via JS in case one is set
                ) + s.text
              end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
<% end %>
