<% if flash[:alert].present? %>
  <% flash[:alert].each do |msg| %>
    <div class="alert alert-danger">
      <%= I18n.t("activerecord.models.attributes.#{msg.first}") %>
      <%= msg.second %>
    </div>
  <% end %>
<% end %>

<%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put }) do |f| %>
  <%= render "devise/shared/error_messages", resource: resource %>

  <%= f.hidden_field :cpf, value: @patient.cpf %>

  <div class="row text-center">
    <div class="col">
      <p class="h1">Edição</p>
    </div>
  </div>
  <h3 class="text-center">Dados Pessoais</h3>
  <div class="form-row">
    <div class="form-group col-md-6">
      <%= f.label :name, "Nome Completo" %>
      <%= f.text_field :name, autofocus: true, autocomplete: "name", required: true, class: "form-control" %>
    </div>

    <div class="form-group col-md-6">
      <%= f.label :email, "E-mail" %>
      <%= f.email_field :email, autofocus: true, autocomplete: "email", required: false, class: "form-control" %>
    </div>
  </div>

  <div class="form-row">
    <div class="form-group col-md-6">
      <%= f.label :birth_date, "Data de nascimento" %>
      <div class="form-row">
        <%
          year = @patient.birth_date[0..3].to_i
          month = @patient.birth_date[5..6].to_i
          day = @patient.birth_date[8..9].to_i
        %>
        <%= f.date_select :birth_date, { selected: { year: year, month: month, day: day }, start_year: 1900 , with_css_classes: true } , autofocus: true, autocomplete: "birth_date", required: true, class: "form-control" %>
      </div>
    </div>

    <div class="form-group col-md-6">
      <%= f.label :sus, "Cartão SUS" %>
      <%= f.number_field :sus, autofocus: true, autocomplete: "sus", required: false, class: "form-control" %>
    </div>
  </div>

  <div class="form-row">
    <div class="form-group col-md-6">
      <%= f.label :groups, "Grupo(s) que faz parte (opcional):" %>
      <div class="form-check">
        <%= f.collection_check_boxes :groups, Group.all, :id, :name do |b| %>
          <div class="row">
            <%= b.label { b.check_box(checked: @patient.groups.map(&:id).include?(b.value), class: "form-check-input") + b.text } %>
          </div>
        <% end %>
      </div>
      <div class="small">*Diabetes mellitus, hipertensão, doença pulmonar obstrutiva crônica, doença renal, doenças cardiovasculares e cerebrovasculares, indivíduos tansplantados de órgão sólido, anemia falciforme, câncer, obesidade grave (IMC &GreaterEqual; 40)</div>
    </div>
  </div>

  <h3 class="text-center">Endereço</h3>

  <div class="form-row">
    <div class="form-group col-md-6">
      <%= f.label :public_place, "Endereço (Rua, Avenida)" %>
      <%= f.text_field :public_place, autofocus: true, autocomplete: "place", required: true, class: "form-control" %>
    </div>

    <div class="form-group col-md-2">
      <%= f.label :place_number, "Número" %>
      <%= f.text_field :place_number, autofocus: true, required: true, class: "form-control" %>
    </div>

    <div class="form-group col-md-4">
      <%= f.label :neighborhood, "Bairro" %>
      <%= f.select :neighborhood, Neighborhood.pluck(:name), {},  { class: "form-control" } %>
    </div>
  </div>

  <div class="form-row">
    <div class="form-group col-md-6">
      <%= f.label :phone, "Telefone" %>
      <%= f.text_field :phone, autofocus: true, autocomplete: "phone", required: true, class: "form-control sp-celphones" %>
    </div>

    <div class="form-group col-md-6">
      <%= f.label :other_phone, "Telefone Secundário (opcional)" %>
      <%= f.text_field :other_phone, autofocus: true, autocomplete: "other_phone", required: false, class: "form-control sp-celphones" %>
    </div>
  </div>

  <div class="form-row">
    <div class="form-group col-md-6">
      <div class="text-center">
        <%= link_to :back, class: "simple-link" do %>
          cancelar
        <% end %>
      </div>
    </div>
    <div class="form-group col-md-6">
      <%= f.submit "Atualizar", class: "btn btn-primary btn-block pull-right" %>
    </div>
  </div>
<% end %>
